# 38 | 架构师应该如何判断技术演进的方向？

面对层出不穷的新技术，我们应该采取什么样的策略？

1. 潮流派

潮流派的典型特征就是对于新技术特别热衷，紧跟技术潮流，当有新的技术出现时，迫切想将新的技术应用到自己的产品中。

首先，新技术需要时间成熟，如果刚出来就用，此时新技术还不怎么成熟，实际应用中很可能遇到各种“坑”，自己成了实验小白鼠。

其次，新技术需要学习，需要花费一定的时间去掌握，这个也是较大的成本；如果等到掌握了技术后又发现不适用，则是一种较大的人力浪费。

2. 保守派

对于新技术抱有很强的戒备心，稳定压倒一切，已经掌握了某种技术，就一直用这种技术打天下。

保守派的主要问题是不能享受新技术带来的收益，例如有了拖拉机，你还偏偏要用牛车。

3. 跟风派

跟着竞争对手的步子走。简单来说，判断技术的发展就看竞争对手，竞争对手用了咱们就用，竞争对手没用咱们就等等看。

跟风派最大的问题在于如果没有风可跟的时候怎么办。即使有风可跟，有时候适用于竞争对手的技术，并不一定适用于自己，盲目模仿可能带来相反的效果。另外，竞争对手的这些信息并不那么容易获取。

既然潮流派、保守派、跟风派都存在这样或者那样的问题，那架构师究竟如何判断技术演进的方向呢？

**技术演进的动力**

归根到底就是业务的发展。影响一个企业业务的发展主要有 3 个因素：市场、技术、管理，这三者构成支撑业务发展的铁三角，任何一个因素的不足，都可能导致企业的业务停滞不前。

<img src="https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210208215828.png" alt="image-20210208215828707" style="zoom: 50%;" />

我们可以简单地将企业的业务分为两类：一类是产品类，一类是服务类。

- 对于产品类业务，技术创新推动业务发展

用户选择一个产品的根本驱动力在于产品的功能是否能够更好地帮助自己完成任务。用户会自然而然地选择那些功能更加强大、性能更加先进、体验更加顺畅、外观更加漂亮的产品，而功能、性能、体验、外观等都需要强大的技术支撑。例如，iPhone 手机的多点触摸操作、UC 浏览器的 U3 内核等。

- 对于“服务”类的业务，业务发展推动技术的发展

用户选择一个产品的根本驱动力是其“功能”，而用户选择一个服务的根本驱动力不是功能，而是“规模”。例如，选择 UC 浏览器还是选择 QQ 浏览器，更多的人是根据个人喜好和体验来决定的；而选择微信还是 Whatsapp，是根据其规模来选择的。

服务类的业务发展路径是这样的：提出一种创新的服务模式→吸引了一批用户→业务开始发展→吸引了更多用户→服务模式不断完善和创新→吸引越来越多的用户，如此循环往复。

在这个发展路径中，技术并没有成为业务发展的驱动力，反过来由于用户规模的不断扩展，业务的不断创新和改进，对技术会提出越来越高的要求，因此是业务驱动了技术发展。

其实回到产品类业务，如果我们将观察的时间拉长来看，即使是产品类业务，在技术创新开创了一个新的业务后，后续的业务发展也会反向推动技术的发展。例如，第一代 iPhone 缺少对 3G 的支持，且只能通过 Web 发布应用程序，第二代 iPhone 才开始支持 3G，并且内置 GPS。

综合这些分析，除非是开创新的技术能够推动或者创造一种新的业务，其他情况下，都是业务的发展推动了技术的发展。

# 39 | 互联网技术演进的模式

以互联网的业务发展为案例，谈谈互联网技术演进的模式，其他行业可以参考分析方法对自己的行业进行分析。

互联网业务发展一般分为几个时期：初创期、发展期、竞争期、成熟期。不同时期的差别主要体现在两个方面：复杂性、用户规模。

**业务复杂性**

1. 初创期

互联网业务刚开始一般都是一个创新的业务点，这个业务点的重点不在于“完善”，而在于“创新”，只有创新才能吸引用户。

初创期的业务对技术就一个要求：“快”。

2. 发展期

当业务推出后经过市场验证如果是可行的，则吸引的用户就会越来越多，此时原来不完善的业务就进入了一个快速发展的时期。

这个阶段技术的核心工作是快速地实现各种需求。如何做到“快”，一般会经历下面几个阶段。

- 堆功能期

  业务进入快速发展期的初期，此时团队规模也不大，业务需求又很紧，最快实现业务需求的方式是继续在原有的系统里面不断地增加新的功能。

- 优化期

  随着功能越来越多，系统开始变得越来越复杂，后面继续堆功能会感到越来越吃力，速度越来越慢。

  如何解决这个问题，一般会分为两派：一派是优化派，一派是架构派。

- 架构期

  如果业务能够继续发展，慢慢就会发现优化也顶不住了，毕竟再怎么优化，系统的能力总是有极限的。

3. 竞争期

当业务继续发展，已经形成一定规模后，一定会有竞争对手开始加入行业来竞争。新业务的创新给技术带来的典型压力就是新的系统会更多，系统数量的量变带来了技术工作的质变。主要体现在下面几个方面：

- 重复造轮子

  系统越来越多，各系统相似的工作越来越多。

- 系统交互一团乱麻

  系统越来越多，各系统的交互关系变成了网状。

针对这个时期业务变化带来的问题，技术工作主要的解决手段有：

- 平台化

  目的在于解决“重复造轮子”的问题。

- 服务化

  目的在于解决“系统交互”的问题，常见的做法是通过消息队列来完成系统间的异步通知，通过服务框架来完成系统间的同步调用。

4. 成熟期

当企业熬过竞争期，成为了行业的领头羊，此时求快求新已经没有很大空间，业务上开始转向为“求精”。

**用户规模**

互联网业务的发展会经历“初创期、发展期、竞争期、成熟期”几个阶段，不同阶段典型的差别就是用户量的差别，用户量随着业务的发展而越来越大。

用户量增大对技术的影响主要体现在两个方面：性能要求越来越高、可用性要求越来越高。

1. 性能

用户量增大，性能要求也越高。以 MySQL 为例，单台 MySQL 机器支撑的 TPS 和 QPS 最高也就是万级，必然要考虑使用多台 MySQL。

2. 可用性

1 万用户宕机 1 小时，你可能才损失了几千元；100 万用户宕机 10 分钟，损失可能就是几十万元了。

**量变到质变**

互联网业务驱动技术发展的两大主要因素是复杂性和用户规模，这两个因素的本质其实都是“量变带来质变”。

![image-20210209223846189](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210209223846.png)

# 40 | 互联网架构模板：“存储层”技术

互联网的标准技术架构如下图所示。

<img src="https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210211075224.png" alt="image-20210211075224419" style="zoom:50%;" />

> 这张图基本上涵盖了互联网技术公司的大部分技术点，不同的公司只是在具体的技术实现上稍有差异，但不会跳出这个框架的范畴

从本期开始，我将逐层介绍每个技术点的产生背景、应用场景、关键技术。今天我们首先来聊聊互联网架构模板的“存储层”技术。

**SQL**

随着互联网业务的发展，性能要求越来越高，必然要面对一个问题：将数据拆分到多个数据库实例才能满足业务的性能需求。

数据库拆分满足了性能的要求，但带来了复杂度的问题：数据如何拆分、数据如何组合？这个复杂度的问题解决起来并不容易，如果每个业务都去实现一遍，重复造轮子将导致投入浪费、效率降低，业务开发想快都快不起来。

所以互联网公司流行的做法是业务发展到一定阶段后，就会将这部分功能独立成中间件。

如果公司业务继续发展，规模继续扩大，SQL 服务器越来越多，实力雄厚的大公司此时一般都会在 SQL 集群上构建 SQL 存储平台，以对业务透明的形式提供资源分配、数据备份、迁移、容灾、读写分离、分库分表等一系列服务。

**NoSQL**

如果公司发展很快，例如 Memcache 的节点有上千甚至几千时，通常都会在 NoSQL 集群的基础之上再实现统一存储平台，统一存储平台主要实现这几个功能：

- 资源按需动态分配：例如同一台 Memcache 服务器，可以根据内存利用率，分配给多个业务使用。
- 资源自动化管理：例如新业务只需要申请多少 Memcache 缓存空间就可以了，无需关注具体是哪些 Memcache 服务器在为自己提供服务。
- 故障自动化处理：例如某台 Memcache 服务器挂掉后，有另外一台备份 Memcache 服务器能立刻接管缓存请求，不会导致丢失很多缓存数据。

**小文件存储**

除了关系型的业务数据，互联网行业还有很多用于展示的数据。例如，淘宝的商品图片。这些数据具有三个典型特征：

一是数据小，一般在 1MB 以下；

二是数量巨大，Facebook 在 2013 年每天上传的照片就达到了 3.5 亿张；

三是访问量巨大，Facebook 每天的访问量超过 10 亿。

得益于开源运动的发展和最近几年大数据的火爆，HBase、Hadoop、Hypertable、FastDFS 等都可以作为小文件存储的底层平台。只需要将这些开源方案再包装一下基本上就可以用了。

典型的小文件存储有：淘宝的 TFS、京东 JFS、Facebook 的 Haystack。下图是淘宝 TFS 的架构：

![image-20210211080852748](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210211080852.png)

**大文件存储**

互联网行业的大文件主要分为两类：一类是业务上的大数据，例如 Youtube 的视频；另一类是海量的日志数据，例如各种访问日志。

说到大文件，特别要提到 Google 和 Yahoo，Google 的 3 篇大数据论文（Bigtable/Map- Reduce/GFS）开启了一个大数据的时代，而 Yahoo 开源的 Hadoop 系列（HDFS、HBase 等），基本上垄断了开源界的大数据处理。

下面是 Hadoop 的生态圈：

![image-20210211075037106](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210211075037.png)

**思考题**

既然存储技术发展到最后都是存储平台，为何没有出现存储平台的开源方案，但云计算却都提供了存储平台方案？





