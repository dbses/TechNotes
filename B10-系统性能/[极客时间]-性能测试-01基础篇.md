# 开篇词

在这个课程中，“性能测试”不仅仅包括测试，还包括分析和调优。

第一个模块：性能测试基础篇。

第二个模块：性能测试工具的实操。

第三个模块：性能分析。

第四个模块：性能测试分析过程。

# 01丨性能综述：性能测试的概念

**性能测试要有指标**

时间指标、容量指标、资源利用率指标。

**性能测试要有模型**

业务模型，比如说，我们有 100 种业务，只有 50 个业务需要有并发量，那就要把这些有并发的业务统计出来，哪个业务并发多，哪个业务并发少，做压力测试时就要控制好这样的比例。

监控模型，这个部分的监控，要有分层、分段的能力，要有全局监控、定向监控的能力。

**性能测试要有方案**

方案规定的内容中有几个关键点，分别是测试环境、测试数据、测试模型、性能指标、压力策略、准入准出和进度风险。

**性能测试要有预定的条件**

这里的条件包括软硬件环境、测试数据、测试执行策略、压力补偿等内容。要是展开来说，在场景执行之前，这些条件应该是确定的。

**性能测试中要有场景**

1. 基准性能场景
2. 容量性能场景
3. 稳定性性能场景
4. 异常性能场景

**性能测试中要有分析调优**

性能项目分以下几类：

- 新系统性能测试类

  这样的项目一般都会要求测试出系统的最大容量。

- 旧系统新版本性能测试类

  只要性能不下降，就可以根据历史数据推算容量。

- 新系统性能测试优化类

  这类系统不仅要测试出最大容量，还要求调优到最好。

对性能团队的职责定位有如下几种：

1. 性能验证
2. 性能测试
3. 性能测试 + 分析调做强

**性能测试要有结果报告**

在报告中写上 TPS、响应时间以及资源对比图。

**性能测试概念总结**

![image-20210528225408650](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210528225408.png)

# 02丨性能综述：TPS和响应时间之间是什么关系？

**系统性能描述图**

关于系统性能，有下面这样一张描述图：

![image-20210529213130760](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210529213130.png)

图中定义了三条曲线、三个区域、两个点以及三个状态描述。

三条曲线：使用率（U）、吞吐量曲线（X）、响应时间曲线（R）。

三个区域：轻负载区（Light Load）、重负载区（Heavy Load）、塌陷区（Buckle Zone）。

两个点：最优并发用户数（The Optimum Number of Consurrent Users）、最大并发用户数（The Maximum Number of Consurrent Users）。

三个状态描述：资源饱和（Resource Saturated）、吞吐下降（Throughput Falling）、用户受影响（End Users Effected）。

**TPS和响应时间**

![image-20210529215017916](https://gitee.com/yanglu_u/ImgRepository/raw/master/images/20210529215017.png)

上图中蓝线表示 TPS，黄线表示响应时间。

在 TPS 增加的过程中，响应时间一开始会处在较低的状态，也就是在 A 点之前。

接着响应时间开始有些增加，直到业务可以承受的时间点 B，这时 TPS 仍然有增长的空间。

再接着增加压力，达到 C 点时，达到最大 TPS。我们再接着增加压力，响应时间接着增加，但 TPS 会有所下降。

> 这里并不是必然的，有些系统在队列上处理得很好，会保持稳定的 TPS，然后多出来的请求都被友好拒绝。

最后，D 点之后响应时间过长，达到了超时的程度。

在实际的性能测试中，基准性能场景也好，容量性能场景也好，都是需要递增的，而不是上来就用几百几千的线程。同时，递增也是要连续的，而不是 100 线程、200 线程、300 线程这样断开执行场景。

> 性能场景为什么要连续？而不是断开？
>
> 递增线程数可以记录每次的性能指标，画曲线对比分析，来观察指标变化的趋势，找出性能瓶颈以及服务器最大处理能力。













